{% extends "main/base.html" %}
{% block title %}Budget Dashboard - Money Tracker{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Budget Dashboard</h1>
    <div class="d-flex gap-2">
      <a href="{{ url_for('budget.setup') }}" class="btn btn-outline-primary">Setup Budgets</a>
      <a href="{{ url_for('budget.status_json') }}" class="btn btn-outline-secondary">JSON</a>
    </div>
  </div>

  {% if budgets %}
  <div class="row g-3">
    {% for b in budgets %}
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <div class="fw-bold">
                {{ b.category_name }} • {{ b.account_label }}
              </div>
              <small class="text-muted">{{ b.period|capitalize }} • {{ b.period_start|date_format('%Y-%m-%d') }} to {{ b.period_end|date_format('%Y-%m-%d') }}</small>
            </div>
            <div>
              <span class="badge bg-secondary">{{ '%.1f' % b.percent_used }}%</span>
            </div>
          </div>

          <div class="small text-muted mb-2">Used: {{ '%.1f' % b.percent_used }}%</div>

          <div class="d-flex justify-content-between small text-muted">
            <div>Budget: OMR {{ '%.3f' % b.amount }}{% if b.rollover and b.rollover > 0 %} + Rollover {{ '%.3f' % b.rollover }}{% endif %}</div>
            <div>Spent: OMR {{ '%.3f' % b.spent }}</div>
            <div>Remaining: OMR {{ '%.3f' % b.remaining }}</div>
          </div>

          {% if b.alerts.custom_exceeded %}
          <div class="alert alert-warning mt-3 mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>Approaching budget limit ({{ '%.0f' % b.alerts.threshold }}%).
          </div>
          {% endif %}
          {% if b.alerts.gte_100 %}
          <div class="alert alert-danger mt-2 mb-0">
            <i class="bi bi-x-octagon me-2"></i>Budget exceeded.
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-5">
    <i class="bi bi-graph-down-arrow display-4 text-muted"></i>
    <p class="mt-3">No budgets yet.</p>
    <a href="{{ url_for('budget.setup') }}" class="btn btn-primary">Create Budgets</a>
  </div>
  {% endif %}

  <div class="mt-3">
    <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
    </a>
  </div>
</div>
{% endblock %}
