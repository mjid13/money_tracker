{% extends "main/base.html" %}

{% block title %}{{ _("Category Mappings") }} - Money Tracker{% endblock %}

{% block content %}
{% include "components/delete_modal.html" %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-0">{{ _("Mappings for \"%(name)s\"", name=category.name) }}</h1>
            <p class="text-muted mb-0">{{ _("Manage patterns that automatically categorize transactions") }}</p>
        </div>
        <a href="{{ url_for('category.add_category_mapping', category_id=category.id) }}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>{{ _("Add Mapping") }}
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <div class="alert alert-info">
                <h5 class="alert-heading"><i class="bi bi-info-circle me-2"></i>{{ _("How Mappings Work") }}</h5>
                <p class="mb-0">{{ _("Mappings automatically categorize transactions based on patterns in the counterparty name or transaction description. When a new transaction matches a pattern, it will be automatically assigned to this category.") }}</p>
            </div>

            {% if mappings %}
            <div class="table-responsive">
                <table class="table table-hover datatable" id="mappingsTable">
                    <thead>
                        <tr>
                            <th>{{ _("Type") }}</th>
                            <th>{{ _("Pattern") }}</th>
                            <th>{{ _("Actions") }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mapping in mappings %}
                        <tr>
                            <td>
                                {% if mapping.mapping_type.name == 'COUNTERPARTY' %}
                                <span class="badge bg-primary">{{ _("Counterparty") }}</span>
                                {% elif mapping.mapping_type.name == 'DESCRIPTION' %}
                                <span class="badge bg-info">{{ _("Description") }}</span>
                                {% endif %}
                            </td>
                            <td><code>{{ mapping.pattern }}</code></td>
                            <td>
                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#deleteConfirmModal"
                                        data-item-type="mapping"
                                        data-item-id="{{ mapping.id }}"
                                        data-delete-url="{{ url_for('category.delete_category_mapping', mapping_id=mapping.id) }}"
                                        data-category-id="{{ category.id }}"
                                        data-details-html="<p class='mb-1'><strong>Type:</strong> {% if mapping.mapping_type.name == 'COUNTERPARTY' %}Counterparty{% elif mapping.mapping_type.name == 'DESCRIPTION' %}Description{% endif %}</p><p class='mb-0'><strong>Pattern:</strong> <code>{{ mapping.pattern }}</code></p>">
                                    <i class="bi bi-trash me-1"></i>_("Delete")
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-link-45deg display-4 text-muted"></i>
                <p class="mt-3 mb-4">No mappings found for this category.</p>
                <a href="{{ url_for('category.add_category_mapping', category_id=category.id) }}" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-2"></i>Add Your First Mapping
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('category.categories') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Back to Categories
        </a>
    </div>
</div>
{% endblock %}