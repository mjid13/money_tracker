<!-- Reusable Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="deleteForm" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <!-- For category mappings, we need to pass the category_id -->
                <input type="hidden" id="modal-category-id" name="category_id">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="delete-confirmation-message"></p>
                    <div id="delete-item-details" class="bg-light p-3 rounded mb-3"></div>
                    <div id="delete-warning" class="text-danger"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script nonce="{{ csp_nonce() }}">
    document.addEventListener('DOMContentLoaded', function() {
        var deleteModal = document.getElementById('deleteConfirmModal');
        if (!deleteModal) return;

        deleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            if (!button) return; // Safety if modal opened directly

            // Get data from button attributes
            var itemType = button.getAttribute('data-item-type');
            var itemId = button.getAttribute('data-item-id');
            var itemName = button.getAttribute('data-item-name');
            var deleteUrl = button.getAttribute('data-delete-url');
            var categoryId = button.getAttribute('data-category-id') || '';
            var warningText = button.getAttribute('data-warning-text') || '';
            var detailsHtml = button.getAttribute('data-details-html') || '';

            // Set form action
            document.getElementById('deleteForm').action = deleteUrl;

            // Set category ID if provided (for mappings)
            var categoryIdField = document.getElementById('modal-category-id');
            if (categoryIdField) {
                categoryIdField.value = categoryId;
            }

            // Set confirmation message
            var messageElement = document.getElementById('delete-confirmation-message');
            if (messageElement) {
                if (itemType === 'category') {
                    messageElement.innerHTML = 'Are you sure you want to delete the category <strong>' + itemName + '</strong>?';
                } else if (itemType === 'mapping') {
                    messageElement.innerHTML = 'Are you sure you want to delete this mapping?';
                }
            }

            // Set item details
            var detailsElement = document.getElementById('delete-item-details');
            if (detailsElement) {
                detailsElement.innerHTML = detailsHtml;
                detailsElement.style.display = detailsHtml ? 'block' : 'none';
            }

            // Set warning text
            var warningElement = document.getElementById('delete-warning');
            if (warningElement) {
                warningElement.innerHTML = warningText;
                warningElement.style.display = warningText ? 'block' : 'none';
            }
        });
    });
</script>